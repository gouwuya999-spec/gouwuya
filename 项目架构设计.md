# VPS管理系统 - 项目架构设计

## 📋 项目概述

VPS管理系统是一个基于Electron的桌面应用程序，用于管理多台VPS服务器，支持SSH连接、Wireguard VPN部署、VPS账单统计等功能。

### 核心功能
- **服务器管理**: 多服务器SSH连接管理
- **Wireguard部署**: 一键部署和管理Wireguard VPN
- **账单统计**: VPS费用统计和Excel导出
- **实时监控**: 部署进度实时显示和状态监控

---

## 🏗️ 系统架构

### 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    VPS管理系统架构                          │
├─────────────────────────────────────────────────────────────┤
│  前端层 (Renderer Process)                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   服务器管理     │  │  Wireguard管理  │  │  账单统计    │ │
│  │   - SSH连接     │  │   - 一键部署    │  │   - 费用计算  │ │
│  │   - 连接测试    │  │   - 实例管理    │  │   - Excel导出 │ │
│  │   - 批量操作    │  │   - Peer管理    │  │   - 历史记录  │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  通信层 (IPC)                                               │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              preload.js (安全桥接)                      │ │
│  │  - 暴露安全的API接口                                    │ │
│  │  - 处理前后端通信                                       │ │
│  │  - 剪贴板操作                                           │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  后端层 (Main Process)                                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   SSH管理模块   │  │  Wireguard模块  │  │  账单管理模块 │ │
│  │   - 连接管理    │  │   - 脚本执行    │  │   - 数据计算  │ │
│  │   - 命令执行    │  │   - 配置生成    │  │   - 文件导出  │ │
│  │   - 会话保持    │  │   - 进度监控    │  │   - 汇率处理  │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  数据层                                                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────┐ │
│  │   服务器配置    │  │  Wireguard配置  │  │  VPS数据文件  │ │
│  │   - 连接信息    │  │   - 实例配置    │  │   - 账单数据  │ │
│  │   - 认证信息    │  │   - 客户端配置  │  │   - 汇率数据  │ │
│  └─────────────────┘  └─────────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

---

## 📁 文件结构

### 核心文件
```
VPS管理系统/
├── main.js                 # 主进程入口文件
├── preload.js              # 预加载脚本，安全桥接
├── renderer.js             # 渲染进程，前端逻辑
├── index.html              # 主界面HTML
├── package.json            # 项目配置和依赖
├── requirements.txt        # Python依赖
├── billing_manager.py      # 账单管理Python模块
└── vps_data.yml           # VPS数据存储文件
```

### 资源文件
```
├── icon.ico               # 应用图标
├── icon.png               # 应用图标PNG
├── fonts/                 # 字体文件
├── exchange_rates/        # 汇率数据
│   ├── exchange_rate_2024_12.json
│   ├── exchange_rate_2025_1.json
│   └── ...
└── dist/                  # 构建输出目录
```

### 启动脚本
```
├── launch_vps_optimized.vbs  # 优化启动脚本
└── launch_vps_silent.vbs     # 静默启动脚本
```

---

## 🔧 技术栈

### 前端技术
- **Electron**: 跨平台桌面应用框架
- **Vue.js 3**: 响应式前端框架
- **HTML5/CSS3**: 界面结构和样式
- **Font Awesome**: 图标库

### 后端技术
- **Node.js**: JavaScript运行时
- **Python**: 账单计算和数据处理
- **SSH2**: SSH连接库
- **QRCode**: 二维码生成

### 数据存储
- **YAML**: VPS数据存储格式
- **JSON**: 汇率和配置文件
- **Excel**: 账单导出格式

---

## 🚀 核心功能模块

### 1. 服务器管理模块

#### 功能特性
- **多服务器支持**: 支持管理多台VPS服务器
- **SSH连接**: 支持密码和私钥认证
- **连接测试**: 实时测试服务器连接状态
- **批量操作**: 支持批量添加和部署

#### 技术实现
```javascript
// 服务器连接管理
class ServerManager {
  async connectServer(serverConfig) {
    // SSH连接逻辑
  }
  
  async testConnection(serverId) {
    // 连接测试逻辑
  }
  
  async executeCommand(command) {
    // 命令执行逻辑
  }
}
```

### 2. Wireguard管理模块

#### 功能特性
- **一键部署**: 自动化Wireguard部署流程
- **智能清理**: 自动检测和清理现有实例
- **多实例支持**: 支持多个Wireguard实例
- **实时监控**: 部署进度实时显示
- **配置管理**: 客户端配置和二维码生成

#### 部署流程
```
1. 环境检查 → 2. 清理现有实例 → 3. 解决APT锁冲突
4. 更新系统 → 5. 安装组件 → 6. 配置网络
7. 检测接口 → 8. 生成配置 → 9. 启动服务
10. 生成客户端配置 → 11. 实时更新
```

#### 技术实现
```javascript
// Wireguard部署管理
class WireguardManager {
  async deployWireguard(serverId) {
    // 部署流程控制
  }
  
  async cleanupExistingInstances() {
    // 清理现有实例
  }
  
  async generateClientConfig() {
    // 生成客户端配置
  }
}
```

### 3. 账单统计模块

#### 功能特性
- **费用计算**: 自动计算VPS使用费用
- **汇率支持**: 多货币汇率转换
- **Excel导出**: 支持Excel格式导出
- **历史记录**: 月度账单历史记录
- **批量管理**: 支持批量添加VPS

#### 数据流程
```
VPS数据输入 → 费用计算 → 汇率转换 → 账单生成 → Excel导出
```

#### 技术实现
```python
# 账单管理Python模块
class BillingManager:
    def calculate_monthly_bill(self, year, month):
        # 月度账单计算
        pass
    
    def export_to_excel(self, data):
        # Excel导出
        pass
    
    def update_exchange_rates(self):
        # 汇率更新
        pass
```

---

## 🔄 数据流架构

### 数据流向图
```
用户操作 → 前端界面 → IPC通信 → 主进程处理 → 数据存储
    ↓
SSH连接 → 远程服务器 → 脚本执行 → 结果返回 → 界面更新
    ↓
账单计算 → Python处理 → 数据计算 → 结果存储 → 界面显示
```

### 关键数据流
1. **服务器连接**: 用户输入 → 连接测试 → 状态更新
2. **Wireguard部署**: 部署请求 → 脚本执行 → 进度更新 → 配置生成
3. **账单统计**: 数据输入 → 费用计算 → 结果展示 → 导出功能

---

## 🛡️ 安全架构

### 安全措施
- **进程隔离**: 主进程和渲染进程分离
- **API限制**: 通过preload.js限制API访问
- **数据加密**: 敏感数据本地加密存储
- **权限控制**: 最小权限原则

### 安全实现
```javascript
// preload.js - 安全API暴露
contextBridge.exposeInMainWorld('electronAPI', {
  // 只暴露必要的API
  saveServer: (data) => ipcRenderer.invoke('save-server', data),
  // 其他安全API...
});
```

---

## 📊 性能优化

### 优化策略
- **异步处理**: 所有IO操作异步执行
- **进度监控**: 实时显示操作进度
- **错误处理**: 完善的错误处理和恢复机制
- **资源管理**: 及时释放SSH连接和资源

### 性能监控
```javascript
// 性能监控实现
class PerformanceMonitor {
  trackOperation(operation, callback) {
    const startTime = Date.now();
    return callback().finally(() => {
      const duration = Date.now() - startTime;
      console.log(`${operation} 耗时: ${duration}ms`);
    });
  }
}
```

---

## 🔧 部署和构建

### 开发环境
```bash
# 安装依赖
npm install

# 开发模式启动
npm run dev

# 构建应用
npm run build
```

### 生产构建
```bash
# 构建Windows安装包
npm run dist

# 构建便携版
npm run pack-portable
```

### 构建配置
- **Electron Builder**: 跨平台构建工具
- **NSIS安装包**: Windows安装程序
- **便携版**: 免安装版本
- **自动更新**: 支持应用自动更新

---

## 📈 扩展性设计

### 模块化架构
- **插件系统**: 支持功能插件扩展
- **配置管理**: 灵活的配置管理系统
- **API接口**: 标准化的API接口设计
- **数据格式**: 可扩展的数据存储格式

### 未来扩展
- **云同步**: 支持配置云端同步
- **多用户**: 支持多用户管理
- **监控告警**: 服务器状态监控
- **自动化**: 更多自动化运维功能

---

## 🐛 错误处理和日志

### 错误处理策略
- **分层处理**: 前端、后端分层错误处理
- **用户友好**: 提供清晰的错误信息
- **自动恢复**: 支持自动错误恢复
- **日志记录**: 详细的操作日志

### 日志系统
```javascript
// 日志记录实现
class Logger {
  log(level, message, data) {
    const timestamp = new Date().toISOString();
    console.log(`[${timestamp}] [${level}] ${message}`, data);
  }
}
```

---

## 📋 版本管理

### 版本信息
- **当前版本**: v1.1.0
- **版本格式**: 语义化版本控制
- **更新策略**: 向后兼容的更新策略
- **发布流程**: 自动化发布流程

### 版本历史
- **v1.0.0**: 初始版本，基础功能
- **v1.1.0**: 功能增强，性能优化
- **v1.2.0**: Wireguard重新部署功能

---

## 🎯 总结

VPS管理系统采用现代化的Electron架构，实现了完整的VPS管理功能。系统具有以下特点：

### 技术优势
- **跨平台**: 基于Electron的跨平台支持
- **模块化**: 清晰的模块化架构设计
- **可扩展**: 良好的扩展性和维护性
- **用户友好**: 直观的用户界面和操作体验

### 功能完整性
- **服务器管理**: 完整的SSH连接管理
- **VPN部署**: 自动化Wireguard部署
- **账单统计**: 全面的费用统计功能
- **实时监控**: 实时进度和状态监控

### 系统稳定性
- **错误处理**: 完善的错误处理机制
- **性能优化**: 多层次的性能优化
- **安全设计**: 全面的安全防护措施
- **数据保护**: 可靠的数据存储和备份

这个架构设计为VPS管理系统提供了坚实的基础，支持当前功能的稳定运行，也为未来的功能扩展留下了充足的空间。
