# VPS管理系统连接功能修改说明

## 修改概述

根据用户需求，修改了红色方框的连接功能，实现了以下功能：

1. **直接SSH连接**：点击连接按钮后直接通过SSH连接到远程服务器
2. **在线状态显示**：在服务器卡片右侧显示实时连接状态
3. **同步功能**：添加或删除VPS时自动同步连接状态管理

## 主要修改内容

### 1. 数据模型修改 (renderer.js)

添加了连接状态管理相关的数据属性：

```javascript
// 添加连接状态管理
connectedServers: new Set(), // 存储已连接服务器的ID
connectionStatus: {}, // 存储每个服务器的连接状态
```

### 2. 连接功能重构

#### 原功能
- 点击连接按钮打开SSH终端模态框
- 需要手动操作才能看到连接状态

#### 新功能
- 点击连接按钮直接建立SSH连接
- 实时显示连接状态（在线/离线/连接中）
- 支持一键断开连接
- 连接状态持久化显示

### 3. 用户界面改进

#### 连接状态显示
- 在服务器卡片上添加了状态指示器
- 使用不同颜色的圆点表示状态：
  - 🟢 绿色：在线
  - 🟠 橙色：连接中
  - 🔴 红色：离线

#### 连接按钮优化
- 动态显示按钮文本：连接/断开
- 连接中时按钮禁用并显示加载状态
- 已连接时按钮变为红色断开按钮

#### 通知系统
- 添加了右上角通知消息
- 显示连接成功/失败/断开等状态
- 自动3秒后消失

### 4. 状态管理同步

#### 添加服务器时
- 自动初始化新服务器的连接状态为"离线"
- 显示添加成功通知

#### 删除服务器时
- 如果服务器已连接，先自动断开连接
- 清理相关连接状态数据
- 显示删除成功通知

#### 加载服务器时
- 初始化所有服务器的连接状态为"离线"

## 技术实现细节

### 连接状态管理
```javascript
// 连接服务器
async connectServer(server) {
  // 如果已连接，则断开
  if (this.connectedServers.has(server.id)) {
    await this.disconnectServer(server);
    return;
  }
  
  // 设置连接中状态
  this.connectionStatus[server.id] = 'connecting';
  
  // 建立SSH连接
  const result = await window.electronAPI.openSSHTerminal(server.id);
  
  if (result.success) {
    this.connectedServers.add(server.id);
    this.connectionStatus[server.id] = 'connected';
  } else {
    this.connectionStatus[server.id] = 'disconnected';
  }
}
```

### 状态显示逻辑
```javascript
// 获取服务器连接状态
getServerConnectionStatus(serverId) {
  return this.connectionStatus[serverId] || 'disconnected';
}

// 检查服务器是否已连接
isServerConnected(serverId) {
  return this.connectedServers.has(serverId);
}
```

### CSS样式
```css
/* 连接状态样式 */
.connection-status.connected { color: #4CAF50; }
.connection-status.connecting { color: #FF9800; }
.connection-status.disconnected { color: #f44336; }

/* 连接按钮样式 */
button.connected { background-color: #f44336; }
button.connecting { background-color: #FF9800; cursor: not-allowed; }
```

## 用户体验改进

1. **即时反馈**：点击连接后立即看到状态变化
2. **状态持久化**：连接状态在界面中持续显示
3. **操作简化**：一键连接/断开，无需进入其他页面
4. **视觉清晰**：使用颜色和图标清晰表示状态
5. **通知提醒**：重要操作都有通知反馈

## 兼容性说明

- 保持了原有的SSH终端功能（通过其他方式访问）
- 保持了所有原有的服务器管理功能
- 新增功能不影响现有功能的使用

## 测试建议

1. 添加新服务器，验证状态初始化
2. 点击连接按钮，验证连接建立和状态显示
3. 点击断开按钮，验证连接断开
4. 删除已连接的服务器，验证自动断开
5. 测试连接失败的情况，验证错误处理

## 文件修改清单

- `renderer.js`：主要逻辑修改
- `index.html`：界面模板和样式修改
- 新增：连接状态管理、通知系统、状态同步逻辑
